.\" Manpage for log_memusage.
.\" Contact csgteam@ucar.edu to correct errors or typos.
.TH man 3 "25 January 2023" "1.0" "log_memusage man page"

.SH NAME
log_memusage \- Logs memory usage history of an application.

.SH SYNOPSIS
.nf
$ gcc -o my_app my_app.c -llog_memusage
$ ./my_app
.fi

$ mpiexec -x LD_PRELOAD=/path/to/liblog_memusage.so <mpi_program>

.SH DESCRIPTION
log_memusage is a library that monitors and reports application memory usage.

.SH ENVIRONMENT
.SS General Environment Variables
.PP
\fBLOG_MEMUSAGE\fR
.RS 4
If enabled (1), logs memory usage vs. time to the output file "memory_usage.log".
.sp
Default: 0\&
.RE
.PP
\fBLOG_MEMUSAGE_POLL_INTERVAL\fR
.RS 4
Floating point value specifying the polling frequency (in seconds).
.sp
Default: 0.1\&
.RE
.PP
\fB LOG_MEMUSAGE_OUTPUT_INTERVAL\fR
.RS 4
Integer value specifying output frequency, in multiples of \fBLOG_MEMUSAGE_POLL_INTERVAL\fR.
For example, a value of 10 will update the memory usage output log file every 10 polling intervals.
.sp
Default: 1\&
.RE


.SH EXAMPLES
.SS Baseline, uninstrumented program:
.nf

$ ./use_memory -s 50000000
Allocating, using and freeing 50000000 ints (190.73 MiB) in thread 0/1
.fi

.SS Using \fbLD_PRELOAD\fR to instrument an existing program:
.nf
$ LD_PRELOAD=./liblog_memusage.so ./use_memory -s 50000000
logging memory usage for process 103284 to memory_usage.log ...
Allocating, using and freeing 50000000 ints (190.73 MiB) in thread 0/1
# (memusage) --> casper-login2 / PID 103284, peak used memory: 213 MiB
.fi


.SS Using \fbLD_PRELOAD\fR to instrument an existing OpenMP program:
.nf
$ LD_PRELOAD=./liblog_memusage.so OMP_NUM_THREADS=6 ./use_memory_openmp -s 50000000
logging memory usage for process 106876 to memory_usage.log ...
Allocating, using and freeing 100000000 ints (381.47 MiB) in thread 1/6
Allocating, using and freeing 200000000 ints (762.94 MiB) in thread 3/6
Allocating, using and freeing 150000000 ints (572.20 MiB) in thread 2/6
Allocating, using and freeing 50000000 ints (190.73 MiB) in thread 0/6
Allocating, using and freeing 250000000 ints (953.67 MiB) in thread 4/6
Allocating, using and freeing 300000000 ints (1144.41 MiB) in thread 5/6
# (memusage) --> casper-login2 / PID 106876, peak used memory: 4036 MiB
.fi


.SS Using \fbpkg-config\fR configuration to link with an application:
compile:
.nf
$ gcc -o use_memory ./use_memory.c $(pkg-config log_memusage --libs --cflags)
.sp
.fi
run:
.nf
$ ./use_memory
logging memory usage for process 111615 to memory_usage.log ...
Allocating, using and freeing 1000000 ints (3.81 MiB) in thread 0/1
# (memusage) --> casper-login2 / PID 111615, peak used memory: 24 MiB
.fi



.SH SEE ALSO
peak_memusage(3)

.SH BUGS
No known bugs.

.SH AUTHOR
Ben Kirk (benkirk@ucar.edu)
